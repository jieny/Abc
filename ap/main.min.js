(e=>{let t=window,o=e=>document.getElementById(e),n=t.showMsg=((e,t)=>{t=t||3e3;let n=o("msg");try{clearTimeout(n.t)}catch(e){}n.innerHTML=e,n.className+=" msgShow",n.t=setTimeout(()=>{n.className="msg"},t)}),c=!0,r={cn:{ssid:"WiFi名称",wifiPwd:"WiFi密码",user:"用户名",userPwd:"密码",websocketDomain:"WebSocket主机",websocketPort:"WebSocket端口",websocketPath:"WebSocket路径",nickname:"昵称",token:"令牌",setArguments:"设置参数",reboot:"重启",rebootNow:"立即重启",rollback:"回滚固件",deepSleep:"睡眠10分钟",txtError:"错误",txtSet:"设置参数成功",txtDelayReboot:"设备将会在3秒后重启",txtRollback:"回滚操作成功",txtDeepSleep:"设备即将睡眠",txtConnected:"已连接",txtDisconnected:"已断开",txtInvalid:"不合法"},en:{ssid:"WiFi SSID",wifiPwd:"WiFi password",user:"User name",userPwd:"password",websocketDomain:"WebSocket host",websocketPort:"WebSocket port",websocketPath:"WebSocket path",nickname:"Nickname",token:"Token",setArguments:"Submit",reboot:"Reboot",rebootNow:"Reboot immediately",rollback:"Rollback firmware",deepSleep:"Deep sleep 10 minutes",txtError:"Error",txtSet:"Arguments set",txtDelayReboot:"Will reboot in 3 seconds",txtRollback:"Rollback OK",txtDeepSleep:"Will into deep sleep in 3 seconds",txtConnected:"Connected",txtDisconnected:"Disconnected",txtInvalid:" Invalid"}};(e=>{let t=navigator.language;t.length&&(t=t.substring(0,2).toLowerCase(),t.startsWith("en")&&(c=!1));let o=document.getElementsByTagName("a");for(let e of o)e.href&&""!=e.href||(e.href="javascript:void(0);"),e.innerText=c?r.cn[e.id]:r.en[e.id];o=document.getElementsByTagName("input");for(let e of o)"text"!=e.type&&"password"!=e.type||(e.placeholder=c?r.cn[e.id]:r.en[e.id])})();let l=t.connectWebsocket=(e=>{try{t.webSocket=new WebSocket("ws://"+t.location.host+":80"),t.webSocket.binaryType="arraybuffer",t.webSocket.onerror=(e=>{n((c?r.cn.txtError:r.en.txtError)+": "+JSON.stringify(e)),setTimeout(()=>{l()},1e3)}),t.webSocket.onmessage=(e=>{if(e.data&&e.data.byteLength>=2){let t=decodeArrayBuffer(e.data);t&&t.length&&(0==t[0]?n(c?r.cn.txtSet:r.en.txtSet):1==t[0]?n(c?r.cn.txtDelayReboot:r.en.txtDelayReboot):136==t[0]?n(c?r.cn.txtRollback:r.en.rollback):137==t[0]?n(c?r.cn.txtDeepSleep:r.en.deepSleep):t[0])}}),t.webSocket.onopen=function(){n(c?r.cn.txtConnected:r.en.txtConnected)},t.webSocket.onclose=(e=>{n(c?r.cn.txtDisconnected:r.en.txtDisconnected),setTimeout(()=>{l()},1e3)})}catch(e){setTimeout(()=>{l()},1e3)}});t.connectWebsocket();let i=t.launch=function(e){t.webSocket.send(createArrayBuffer(e))};o("setArguments").onclick=(e=>{let t=e=>{n(e+(c?r.cn.txtInvalid:r.en.txtInvalid))},l=o("nickname").value,a=o("ssid").value;if(!a.trim().length)return void t(c?r.cn.ssid:r.en.ssid);let s=o("wifiPwd").value;if(!s.trim().length)return void t(c?r.cn.wifiPwd:r.en.wifiPwd);let d=o("user").value;if(!d.trim().length)return void t(c?r.cn.user:r.en.user);let b=o("userPwd").value;if(!b.trim().length)return void t(c?r.cn.userPwd:r.en.userPwd);let u=o("websocketDomain").value;if(!u.trim().length)return void t(c?r.cn.websocketDomain:r.en.websocketDomain);let k=o("websocketPort").value;k=k.replace(/\s/g,""),k=k.length?k:"80",k=parseInt(k);let w=o("websocketPath").value;w=w.replace(/\s/g,""),w=w.length?w:"/";let m=o("token").value;i([0,l,a,s,new Uint8Array(getHash(d,!0)),new Uint8Array(getHash(b,!0)),u,k,w,m])}),o("reboot").onclick=(e=>{i([1])}),o("rebootNow").onclick=(e=>{i([2])}),o("rollback").onclick=(e=>{i([136])}),o("deepSleep").onclick=(e=>{i([137])}),(e=>{let t=document.getElementsByTagName("input");for(let e of t)"text"!=e.type&&"password"!=e.type||(e.onkeyup=function(e){localStorage[this.id]=this.value});for(let e in localStorage){let t=o(e);t&&(t.value=localStorage[e])}})()})();